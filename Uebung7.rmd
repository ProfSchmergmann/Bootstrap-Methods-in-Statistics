---
title: "boot_uebung7_team1"
author: "Sven Bergmann, Malte Lennartz"
date: "`r Sys.Date()`"
output:
html_document:
df_print: paged
---

## Exercise 5.1
Simulate observations $(Y_i, x_i)_{1\leq n}$, with $n = 50$, according to the model
$$Y_i = x_i \beta + \epsilon_i, x_i = \frac{i}{n},$$
where $\epsilon_1, \ldots, \epsilon_n\sim\mathscr{N}(0,\sigma^2)$ are iid., $\beta = 0.5$, and $\sigma^2 = 4$.
```{r}
n <- 50
x <- (1:n) / n
Y_i <- function(beta_1 = 0.5, mean_epsilon = 0, sigma_squared = 4, x) {
  n <- length(x)
  return(x * beta_1 + rnorm(n = n, mean = mean_epsilon, sd = sqrt(sigma_squared)))
}
y_i <- Y_i(x = x)
```
(i) Use Theorem 5.2.2 to construct an approximative ci. for $\beta$ to the level 0.1.
```{r}
theorem_522 <- function(x, Y_i, alpha) {
  n <- length(Y_i)
  V_minus1 <- solve((1 / n) * t(x) %*% x)

  # beta_hat <- lm(formula = Y_i~x-1)$coefficients
  beta_hat <- solve(t(x) %*% x) %*% t(x) %*% Y_i

  s_n_squared <- (t(Y_i - x %*% beta_hat) %*% (Y_i - x %*% beta_hat)) / n
  alpha_qantile <- qnorm(1 - alpha / 2)
  left <- beta_hat - alpha_qantile * sqrt((s_n_squared * V_minus1) / n)
  right <- beta_hat + alpha_qantile * sqrt((s_n_squared * V_minus1) / n)
  return(c(left, right, beta_hat))
}
print(theorem_522(x = x, Y_i = y_i, alpha = 0.1))
```
(ii) Use Theorem 5.3.3 with 1000 bootstrap replications to construct an approximative ci. to the level 0.1.
```{r}
resampling_51 <- function (Y_i, x, beta_hat){
  epsilon_hat <- Y_i - x %*% beta_hat
  epsilon_tilde <- epsilon_hat - mean(epsilon_hat)
  F <- ecdf(epsilon_tilde)
  F()
  Y_star <- t(x) %*% beta_hat + eps
}
```

(iii) Repeat the steps (i) and (ii) 100 times. Determine the mean interval widths for the 100 intervals based on normal approximation and for the 100 intervals based on bootstrap approximation. Furthermore, obtain the coverage levels corresponding to the two approximations.

## Exercise 5.2.
Take the model given under Exercise 5.1.

- (i) Use Theorem 5.3.3 to construct a bootstrap based test for
H0 :   = 0:4 against H1 :   > 0:4
and determine the approximative p-value based on 1000 bootstrap replications.

- (ii) Repeat the generation of the observations according to the model 100 times and
use the bootstrap test developed under (i) for each data set to calculate the
corresponding p-value. Visualize the edf. of the 100 p-values and interpret the
result.